(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{5248:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return a(7772)}])},7720:function(e,s,a){"use strict";var t=a(5893),n=a(7294),r=a(5007),l=a(796),c=a(7741),i=a(9633),o=a(4687),d=a(1163);s.Z=function(e){let{image:s,price:a,quantity:u,number:h,name:m,productId:p,removeBtn:x,maxCount:j,orderQuantity:_}=e,{loginData:f}=(0,r.v9)(i.YN),{guestUserId:N}=(0,r.v9)(l.KY),k=(0,r.I0)(),{pathname:v}=(0,d.useRouter)(),g=e=>{k((0,c.IV)({userToken:f.access_token,productId:e,guestUserId:N}))},y=(e,s,a,t)=>{"-"===a&&(s>1?k((0,c.u_)({userToken:f.access_token,productId:e,productCount:1*s-1,guestUserId:N})):k((0,c.IV)({userToken:f.access_token,productId:e,guestUserId:N}))),"+"===a&&s<t&&k((0,c.u_)({userToken:f.access_token,productId:e,productCount:1*s+1,guestUserId:N}))};return(0,n.useEffect)(()=>{},[v]),(0,t.jsxs)("div",{className:"basket__item",children:[(0,t.jsx)("p",{children:h}),(0,t.jsx)("div",{className:"basket__item-img",children:(0,t.jsx)("img",{src:"http://api.calcarela.com/"+s,alt:"img"})}),(0,t.jsx)("h4",{children:m}),(0,t.jsxs)("p",{className:"price",children:[a," ₽"]}),(0,t.jsx)("div",{className:"counter",children:(0,t.jsx)("div",{className:"counter-flex",children:"/checkout"!==v&&"/orderSingle/[id]"!==v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>y(p,u,"-",j),children:(0,t.jsx)(o.V_,{})}),(0,t.jsx)("span",{children:u}),(0,t.jsx)("button",{onClick:()=>y(p,u,"+",j),children:(0,t.jsx)(o.pO,{})})]}):(0,t.jsx)("span",{children:_||u})})}),(0,t.jsxs)("p",{className:"total-price",children:[_?_*a:u*a," ₽"]}),"/checkout"!==v&&"/orderSingle/[id]"!==v?(0,t.jsx)("button",{className:"remove-btn",onClick:()=>g(p),children:(0,t.jsx)(o.HF,{})}):""]})}},1575:function(e,s,a){"use strict";var t=a(5893),n=a(7294),r=a(7720),l=a(5007),c=a(796),i=a(7741),o=a(9633),d=a(1163);s.Z=function(){let{cartData:e,guestUserId:s}=(0,l.v9)(c.KY),[a,u]=(0,n.useState)(!1),{loginData:h}=(0,l.v9)(o.YN),m=(0,l.I0)(),{pathname:p}=(0,d.useRouter)();return(0,n.useEffect)(()=>{e.length<1&&!a&&(m((0,i.x7)({userToken:h.access_token,guestUserId:s})),u(!0))},[e]),(0,n.useEffect)(()=>{},[p]),(0,t.jsxs)("div",{className:"basket__products",children:[(0,t.jsxs)("div",{className:"basket__products-title",children:[(0,t.jsx)("p",{children:"№"}),(0,t.jsx)("p",{children:"Фото"}),(0,t.jsx)("p",{children:"Наименование"}),(0,t.jsx)("p",{children:"Цена"}),(0,t.jsx)("p",{children:"Количество"}),(0,t.jsx)("p",{children:"Сумма"}),"/checkout"!==p?(0,t.jsx)("p",{children:"удалить"}):""]}),e.length&&(null==e?void 0:e.map((e,s)=>{var a,n;return(0,t.jsx)(r.Z,{image:e.attributes.image,price:e.price,quantity:e.quantity&&e.quantity,number:s+1,name:e.name,productId:e.id,removeBtn:!0,maxCount:(null===(a=e.conditions)||void 0===a?void 0:a.quantity)&&(null===(n=e.conditions)||void 0===n?void 0:n.quantity)},e.id)}))]})}},8232:function(e,s,a){"use strict";var t=a(5893),n=a(1664),r=a.n(n),l=a(7294);s.Z=function(e){let{title:s,links:a}=e;return(0,t.jsx)("div",{className:"brendcrumbs",children:(0,t.jsxs)("div",{className:"brendcrumbs__container _container",children:[(0,t.jsx)(r(),{href:"/",children:"Главная"}),(0,t.jsx)("svg",{width:6,height:10,viewBox:"0 0 6 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{d:"M-5.13609e-08 1.175L3.7085 5L-3.85753e-07 8.825L1.1417 10L6 5L1.1417 -2.12363e-07L-5.13609e-08 1.175Z",fill:"#333333"})}),(null==a?void 0:a.length)?a.map((e,s)=>(0,t.jsxs)(l.Fragment,{children:[(0,t.jsx)(r(),{href:e.link,children:e.name}),(0,t.jsx)("svg",{width:6,height:10,viewBox:"0 0 6 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{d:"M-5.13609e-08 1.175L3.7085 5L-3.85753e-07 8.825L1.1417 10L6 5L1.1417 -2.12363e-07L-5.13609e-08 1.175Z",fill:"#333333"})})]},s)):"",(0,t.jsx)("p",{children:s})]})})}},7772:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return y}});var t=a(5893),n=a(8232),r=a(7294),l=a(5007),c=a(9633),i=a(2175),o=a(6310),d=a(6627),u=a.n(d),h=a(7066),m=a(796),p=a(9332);a(9184);var x=a(6978),j=a(1575),_=a(2870),f=a(1664),N=a.n(f),k=a(7741),v=a(4687),g=function(){let{usersData:e,loginData:s}=(0,l.v9)(c.YN),[a,n]=(0,r.useState)(!1),[d,f]=(0,r.useState)(!1),{totalPrice:g,guestUserId:y}=(0,l.v9)(m.KY),[b,C]=(0,r.useState)(!1),[E,w]=(0,r.useState)(!1),D=(0,l.I0)(),[T,Z]=(0,r.useState)(!1),B=(0,p.useRouter)(),L=(0,r.useRef)(null),I=o.Ry().shape({name:o.Z_().typeError("Напишите свое имя").min(3,"Слишком короткое имя").required("Обязательное поле"),lastName:o.Z_().typeError("Напишите свое отчество").min(3,"Слишком короткое отчество").required("Обязательное поле"),email:o.Z_().typeError("Пример: example@mail.ru").email("Недопустимый формат").required("Обязательное поле"),phone:o.Z_().min(3,"Слишком короткий номер").matches(/[0-9]/,"Только цифры").required("Обязательное поле"),fatherName:o.Z_(),city:o.Z_().required("Обязательное поле")});(0,r.useEffect)(()=>{a||(s.access_token&&D((0,x.BT)({userToken:s.access_token})),n(!0))},[g,e]);let S=(0,r.useCallback)(()=>{w(!1)},[]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("section",{className:"checkout",children:(0,t.jsxs)("div",{className:"checkout__container _container",ref:L,children:[(0,t.jsx)("h1",{children:"Оформление заказа"}),(0,t.jsx)(j.Z,{}),(0,t.jsx)(i.J9,{initialValues:{name:e.name,lastName:e.lastName,fatherName:e.fatherName?e.fatherName:"",phone:e.phone,email:e.email,created_at:e.created_at,company:e.company?e.company:"",city:e.city?e.city:"",post:e.post?e.post:"",country:e.country?e.country:"",region:e.region?e.region:""},onSubmit:async(a,t)=>{let{resetForm:n}=t,r={};e.name?await h.Z.post("http://api.calcarela.com/api/auth/create-order",{cmd:1,address_id:d?e.address.filter(e=>!0===e.checked)[0].id:{name:a.name,lastName:a.lastName,fatherName:a.fatherName,phone:a.phone,email:a.email,created_at:a.created_at,company:a.company,address_1:"values.address_1",address_2:"values.address_2",country:"values.country",post:"values.post",city:a.city,region:a.region,total:g,user_id:e.id,delivery:1,grant_total:g,note:""}},{headers:{Authorization:"Bearer "+s.access_token}}).then(e=>{w(200===e.status),setTimeout(()=>{D((0,k.x7)({userToken:s.access_token})),B.push("/orders")},1900)}):(await h.Z.post("http://api.calcarela.com/api/auth/registration",{name:a.name,lastName:a.lastName,phone:a.phone,email:a.email,password:"65654654",password_confirmation:"65654654",subscribed:!1}).then(e=>{Z(!1),r={...e.data}}).catch(e=>{e.response.data.error.email&&(Z(!0),window.scrollTo(L.current.offsetTop,0))}),r.access_token&&(D((0,c.Ib)({loginData:r,save:!0})),D((0,x.BT)({userToken:r.access_token})),await h.Z.post("http://api.calcarela.com/api/auth/create-order",{cmd:e.name?1:2,uuId:y,address_id:{name:a.name,lastName:a.lastName,fatherName:a.fatherName,phone:a.phone,email:a.email,created_at:a.created_at,company:a.company,address_1:"values.address_1",address_2:"values.address_2",country:"values.country",post:"values.post",city:a.city,region:a.region,total:g,user_id:e.id,delivery:1,grant_total:g,note:""}},{headers:{Authorization:"Bearer "+r.access_token}}).then(e=>{w(200===e.status),D((0,x.AU)({userToken:r.access_token,limit:20,page:1})),setTimeout(()=>{D((0,k.x7)({userToken:r.access_token})),B.push("/orders")},1900)}))),n()},validateOnBlur:!0,validationSchema:d?null:I,children:s=>{let{values:a,errors:n,touched:r,handleChange:l,handleBlur:c,isValid:o,dirty:h,handleSubmit:m}=s;return(0,t.jsxs)(i.l0,{autoComplete:"off",onSubmit:m,className:"checkout__form",children:[(0,t.jsx)("div",{className:"checkout__form-left",children:(0,t.jsx)("div",{className:"checkout__select",children:(0,t.jsxs)("div",{className:"checkout__select-item",children:[(0,t.jsxs)("div",{className:"title",children:[(0,t.jsx)(v.OX,{}),(0,t.jsx)("p",{children:"Способ оплаты"})]}),(0,t.jsxs)("label",{className:"checkbox",onClick:()=>C(!0),children:[(0,t.jsx)("input",{type:"checkbox",checked:!!b}),(0,t.jsx)("span",{}),(0,t.jsx)("p",{children:"Наличными при получении"})]}),(0,t.jsxs)("label",{className:"checkbox",onClick:()=>C(!1),children:[(0,t.jsx)("input",{type:"checkbox",checked:!b,defaultChecked:!0}),(0,t.jsx)("span",{}),(0,t.jsx)("p",{children:"Робокасса"})]})]})})}),(0,t.jsxs)("div",{className:"checkout__right",children:[(0,t.jsxs)("h2",{children:[(0,t.jsx)(v.Dw,{}),"Детали заказа"]}),!e.name&&(0,t.jsxs)("div",{className:"user-buttons",children:[(0,t.jsx)(N(),{href:"/login",children:"Вход /"}),(0,t.jsx)(N(),{href:"/registration",children:" Регистрация"})]}),d?"":(0,t.jsxs)("div",{className:"checkout__newadres",children:[(0,t.jsxs)("label",{className:"input-text",children:["Фамилия *",(0,t.jsx)(i.gN,{type:"text",className:"input",placeholder:"Иванов",name:"lastName",defaultValue:e.lastName,autoComplete:"off",style:{borderColor:n.lastName&&r.lastName?"red":"#EDEDED"},onChange:l,onBlur:c})]}),(0,t.jsxs)("label",{className:"input-text",children:["Имя *",(0,t.jsx)(i.gN,{type:"text",className:"input",placeholder:"Иван",name:"name",defaultValue:e.name,autoComplete:"off",style:{borderColor:n.name&&r.name?"red":"#EDEDED"},onChange:l,onBlur:c})]}),(0,t.jsxs)("label",{className:"input-text",children:["Отчество",(0,t.jsx)(i.gN,{type:"text",className:"input",placeholder:"Иванович",autoComplete:"off",name:"fatherName",style:{borderColor:n.fatherName&&r.fatherName?"red":"#EDEDED"},onChange:l,onBlur:c})]}),(0,t.jsxs)("label",{className:"input-text",style:{color:T?"red":"rgba(51, 51, 51, 0.6)"},children:[T?"Данный E-Mail уже зарегистрирован!":"Эл. адрес *",(0,t.jsx)(i.gN,{type:"text",className:"input",placeholder:"ivan.ivanovich@gmail.com",defaultValue:e.email,name:"email",autoComplete:"off",style:{borderColor:n.email&&r.email||T?"red":"#EDEDED"},onChange:l,onBlur:c})]}),(0,t.jsxs)("label",{className:"input-text",children:["Телефон *",(0,t.jsx)(u(),{type:"text",mask:"+7 (999) 999-99-99",className:"input",placeholder:"+791 502 31111",defaultValue:e.phone,name:"phone",autoComplete:"off",style:{borderColor:n.phone&&r.phone?"red":"#EDEDED"},onChange:l,onBlur:c})]}),(0,t.jsxs)("label",{className:"input-text",children:["Город *",(0,t.jsx)(i.gN,{type:"text",className:"input",placeholder:"Город",defaultValue:e.city&&e.city,name:"city",autoComplete:"off",style:{borderColor:n.city&&r.city?"red":"#EDEDED"},onChange:l,onBlur:c})]})]}),(0,t.jsxs)("label",{className:"input-text",children:["примечания",(0,t.jsx)("textarea",{cols:30,rows:10,className:"input textarea",defaultValue:""})]}),(0,t.jsxs)("div",{className:"checkout__instructions",children:[(0,t.jsx)("h4",{children:"Инструкция"}),(0,t.jsxs)("p",{children:["Получатель платежа:",(0,t.jsx)("span",{children:"БРЕНД-Инструмент"})]}),(0,t.jsxs)("p",{children:["Прием платежей по адресу:",(0,t.jsx)("span",{children:"Москва, Рязанский проспект, д.30, корп.2.ТЦ \xabРязанский\xbb, цокольный этаж."})]})]}),(0,t.jsxs)("div",{className:"checkout__total",children:[(0,t.jsx)("h4",{children:"Общая сумма к оплате"}),(0,t.jsxs)("p",{children:["Сумма:",(0,t.jsxs)("span",{children:[g," ₽"]})]}),(0,t.jsxs)("p",{children:["Итого:",(0,t.jsxs)("span",{children:[g," ₽"]})]})]}),(0,t.jsx)("label",{className:"input-btn",children:(0,t.jsx)("input",{type:"submit",value:"Оформить заказ",className:"input"})})]})]})}}),"-2"]})}),E&&(0,t.jsx)(_.Z,{succsesClick:S,html:!0,time:4e3,title:'Ваш заказ принят! История заказа находится в <Link  href="/orders/"><a href="">Личном кабинете</a></Link> . Для просмотра истории, перейдите по ссылке История заказов. Если у Вас возникли вопросы, пожалуйста свяжитесь с нами. Спасибо за покупки в нашем интернет-магазине!'})]})};function y(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Z,{title:"Оформление заказа",links:[{name:"Корзина",link:"/basket"}]}),(0,t.jsx)(g,{})]})}},1163:function(e,s,a){e.exports=a(3035)}},function(e){e.O(0,[332,888,774,179],function(){return e(e.s=5248)}),_N_E=e.O()}]);